# A service-linked role is a unique type of IAM role that is linked directly to an AWS service.
# Service-linked roles are predefined by the service and include all the permissions that the
# service requires to call other AWS services on your behalf.
AWSTemplateFormatVersion: 2010-09-09
Description: >-
  Provision AWS service linked roles
Resources:
  # EC2 requires a special service-linked role named `AWSServiceRoleForEC2Spot` to launch and manage Spot Instances
  # https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-requests.html#service-linked-roles-spot-instance-requests
  AWSServiceRoleForEC2Spot:
    Type: "AWS::IAM::ServiceLinkedRole"
    Properties:
      AWSServiceName: "spot.amazonaws.com"
      Description: "SLR for EC2 Spot"
  AWSServiceRoleForEC2SpotFleet:
    Type: "AWS::IAM::ServiceLinkedRole"
    Properties:
      AWSServiceName: "spotfleet.amazonaws.com"
      Description: "SLR for EC2 Spot Fleet"
Outputs:
  AWSServiceRoleForEC2SpotId:
    Value: !Ref AWSServiceRoleForEC2Spot
    Export:
      Name: !Sub '${AWS::Region}-${AWS::StackName}-AWSServiceRoleForEC2SpotId'
  AWSServiceRoleForEC2SpotFleetId:
    Value: !Ref AWSServiceRoleForEC2SpotFleet
    Export:
      Name: !Sub '${AWS::Region}-${AWS::StackName}-AWSServiceRoleForEC2SpotFleetId'
